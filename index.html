<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>싸U 주문서</title>

<style>
body {
  margin: 0;
  padding: 16px;
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  background: #ffffff;
  color: #111;
}

h1 {
  font-size: 20px;
  text-align: center;
  margin-bottom: 20px;
}

.section {
  margin-bottom: 24px;
}

.section-title {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 8px;
}

.field {
  margin-bottom: 12px;
}

label {
  display: block;
  font-size: 13px;
  margin-bottom: 4px;
  color: #333;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-sizing: border-box;
}

/* 상품 */
.product {
  border-top: 1px solid #eee;
  padding-top: 12px;
  margin-top: 12px;
}

.row {
  display: flex;
  gap: 8px;
}

.row .field {
  flex: 1;
}

.delete-product {
  background: #ff4d4f;
  color: #fff;
  border-radius: 6px;
  padding: 10px;
  margin-top: 8px;
  border: none;
  width: 100%;
}

/* 합계 */
.summary {
  border-top: 1px solid #eee;
  padding-top: 12px;
}

.summary-line {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin: 6px 0;
}

.summary-total {
  font-weight: 700;
  font-size: 16px;
}

/* 계좌 */
.account-box {
  background: #f5f8ff;
  border: 1px solid #dbe3ff;
  padding: 12px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.account-text {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 14px;
  flex: 1;
}

.copy-btn {
  background: #111;
  color: #fff;
  border-radius: 6px;
  padding: 8px 12px;
  border: none;
  font-size: 13px;
}

/* 버튼 */
button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #f2f2f2;
  color: #111;
}

button.primary {
  background: #111;
  color: #fff;
}

button.danger {
  background: #ff4d4f;
  color: #fff;
}
</style>
</head>

<body>

<h1>싸U 주문서</h1>

<div class="section">
  <div class="section-title">고객 정보</div>
  <div class="field"><label>닉네임</label><input id="nickname"></div>
  <div class="field"><label>이름</label><input id="name"></div>
  <div class="field"><label>연락처</label><input id="phone"></div>
  <div class="field"><label>주소</label><input id="address"></div>
</div>

<div class="section">
  <div class="section-title">상품 정보</div>
  <div id="products"></div>
  <button onclick="addProduct()">+ 상품 추가</button>
  <button class="danger" onclick="removeAllProducts()">상품목록 모두 삭제</button>
</div>

<div class="section summary">
  <div class="summary-line"><span>상품 합계</span><span id="sum">0원</span></div>
  <div class="summary-line"><span>배송비</span><span id="shipping">4,000원</span></div>
  <div class="summary-line summary-total"><span>총 결제금액</span><span id="total">4,000원</span></div>
</div>

<div class="section">
  <div class="section-title">입금 계좌</div>
  <div class="account-box">
    <div class="account-text" id="accountText">
      카카오뱅크 3333-09797-1111 유혜정(유세연)
    </div>
    <button class="copy-btn" onclick="copyAccount()">복사</button>
  </div>
</div>

<button onclick="checkOrder()">주문서 확인</button>
<button class="primary" onclick="submitOrder()">주문 완료</button>
<button onclick="newOrder()">새 주문</button>

<script>
const SHIPPING = 4000;
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby46Q9iopmJHmsh37thoaJ1fJGlm3gWHjc2W0sVm84Ue9q0W31CyFR3KAd69qBqySXk/exec";
const productsDiv = document.getElementById("products");

function addProduct() {
  const div = document.createElement("div");
  div.className = "product";
  div.innerHTML = `
    <div class="field"><label>상품명</label><input></div>
    <div class="row">
      <div class="field"><label>색상</label><input></div>
      <div class="field"><label>사이즈</label><input></div>
    </div>
    <div class="row">
      <div class="field"><label>수량</label><input type="number" value="1"></div>
      <div class="field"><label>가격</label><input type="number"></div>
    </div>
    <button class="delete-product" onclick="removeProduct(this)">이 상품 삭제</button>
  `;
  div.querySelectorAll("input").forEach(i => i.addEventListener("input", calc));
  productsDiv.appendChild(div);
  calc();
}

function removeProduct(btn) {
  btn.parentElement.remove();
  calc();
}

function removeAllProducts() {
  if (!confirm("상품을 모두 삭제할까요?")) return;
  productsDiv.innerHTML = "";
  addProduct();
}

function calc() {
  let sum = 0;
  document.querySelectorAll(".product").forEach(p => {
    const qty = Number(p.querySelectorAll("input")[3].value || 0);
    const price = Number(p.querySelectorAll("input")[4].value || 0);
    sum += qty * price;
  });
  document.getElementById("sum").textContent = sum.toLocaleString() + "원";
  document.getElementById("shipping").textContent = SHIPPING.toLocaleString() + "원";
  document.getElementById("total").textContent = (sum + SHIPPING).toLocaleString() + "원";
}

function copyAccount() {
  navigator.clipboard.writeText(document.getElementById("accountText").innerText);
  alert("계좌번호가 복사되었습니다.");
}

function checkOrder() {
  alert("주문 내용을 확인했습니다.\n문제가 없으면 주문 완료를 눌러주세요.");
}

function submitOrder() {
  if (!confirm("주문을 완료하시겠습니까?")) return;

  const data = {
    nickname: nickname.value,
    name: name.value,
    phone: phone.value,
    address: address.value,
    total: total.innerText,
    products: []
  };

  document.querySelectorAll(".product").forEach(p => {
    data.products.push({
      name: p.querySelectorAll("input")[0].value,
      color: p.querySelectorAll("input")[1].value,
      size: p.querySelectorAll("input")[2].value,
      qty: p.querySelectorAll("input")[3].value,
      price: p.querySelectorAll("input")[4].value
    });
  });

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(data)
  })
  .then(() => alert("주문이 정상적으로 접수되었습니다."))
  .catch(() => alert("주문 전송 중 오류가 발생했습니다."));
}

function newOrder() {
  if (confirm("새 주문을 시작할까요?")) location.reload();
}

addProduct();
</script>

</body>
</html>
