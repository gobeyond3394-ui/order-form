<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>싸U 주문서</title>
<style>
body { font-family:'Arial', sans-serif; background:#ffffff; color:#000; margin:0; padding:20px; }
h1 { text-align:center; color:#001f4d; margin-bottom:20px; }
h2 { margin-top:25px; margin-bottom:10px; color:#001f4d; }

/* 입력 칸 */
.form-group { margin-bottom:12px; }
label { display:block; font-weight:bold; margin-bottom:3px; color:#001f4d; }
input { padding:6px; width:100%; box-sizing:border-box; border-radius:4px; border:1px solid #ccc; background:#fff; }

/* 상품 목록 */
#products { display:flex; flex-direction:column; gap:8px; }
.product { display:flex; flex-wrap:wrap; gap:5px; align-items:center; }
.product div { display:flex; flex-direction:column; flex:1 1 100px; min-width:80px; }
.product input { flex:1; min-width:60px; padding:4px; border-radius:4px; border:1px solid #ccc; text-align:left; }
.product button { flex:0 0 auto; padding:6px 10px; font-weight:bold; border:none; border-radius:10px; cursor:pointer; margin-top:18px; color:#fff; }

/* 버튼 색상 */
button.add { background:#007BFF; color:#fff; }
button.delete { background:#28a745; color:#fff; }
button.check { background:#007BFF; color:#fff; }
button.complete { background:#28a745; color:#fff; }
button.new { background:#6f42c1; color:#fff; }

/* 합계 영역 */
.summary { margin-top:15px; font-size:16px; }
.summary p, .summary h3 { display:flex; justify-content:space-between; margin:5px 0; }
.summary h3 { color:#007BFF; font-weight:bold; }

/* 입금계좌 */
#accountBox { display:flex; justify-content:space-between; align-items:center; background:#cce6ff; border:1px solid #99ccff; padding:8px; border-radius:6px; margin-top:10px; }
#accountBox span { color:#001f4d; font-weight:bold; }
#accountBox button { border:none; border-radius:6px; padding:6px 12px; background:#007BFF; color:#fff; cursor:pointer; }

/* 모달 */
#orderModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
#orderModalContent { background:#fff; color:#000; padding:20px; max-width:600px; width:95%; max-height:80%; overflow:auto; border-radius:10px; }
#orderModalContent h2 { color:#001f4d; }
#orderModalContent button { margin-top:10px; border-radius:8px; padding:6px 12px; border:none; cursor:pointer; }

/* 모바일 */
@media(max-width:600px){ .product { flex-direction:column; align-items:stretch; } .product div{ width:100%; } }
</style>
</head>
<body>

<h1>싸U 주문서</h1>

<h2>고객 정보</h2>
<div class="form-group"><label>닉네임</label><input id="nickname" placeholder="닉네임"></div>
<div class="form-group"><label>이름</label><input id="name" placeholder="이름"></div>
<div class="form-group"><label>연락처</label><input id="phone" placeholder="010-1234-5678"></div>
<div class="form-group"><label>주소</label><input id="address" placeholder="주소"></div>

<h2>상품 목록</h2>
<div style="margin-bottom:10px;">
  <button onclick="addProduct()" class="add">+ 상품 추가</button>
  <button onclick="deleteAllProducts()" class="delete">상품목록 모두 삭제</button>
</div>
<div id="products"></div>

<div class="summary">
  <p>상품 합계: <span id="productSum">0</span>원</p>
  <p>배송비: <span id="shippingFee">4000</span>원</p>
  <h3>총 결제금액: <span id="totalAmount">4000</span>원</h3>
</div>

<div id="accountBox">
  <span>카카오뱅크 3333-09797-1111 유혜정(유세연)</span>
  <button onclick="copyAccount()">복사</button>
</div>

<div style="margin-top:20px;">
  <button onclick="checkOrder()" class="check">주문서 확인</button>
  <button onclick="submitOrderDirect()" class="complete">주문 완료</button>
  <button onclick="newOrder()" class="new">새 주문</button>
</div>

<!-- 모달 -->
<div id="orderModal">
  <div id="orderModalContent">
    <h2>주문서 확인</h2>
    <div id="orderSummary"></div>
    <button onclick="editOrder()" class="check">수정</button>
    <button onclick="submitOrder()" class="complete">주문 완료</button>
    <button onclick="closeModal()" class="delete">닫기</button>
  </div>
</div>

<script>
// 상품 관리
const productsDiv = document.getElementById("products");
const totalAmountEl = document.getElementById("totalAmount");
const shippingFeeEl = document.getElementById("shippingFee");
const productSumEl = document.getElementById("productSum");
const SHIPPING = 4000;

function addProduct(data={}) {
  const div=document.createElement("div");
  div.className="product";
  div.innerHTML = `
    <div><input class="name" value="${data.name||''}" placeholder="상품명"></div>
    <div><input class="color" value="${data.color||''}" placeholder="색상"></div>
    <div><input class="size" value="${data.size||''}" placeholder="사이즈"></div>
    <div><input type="number" class="qty" min="1" value="${data.qty||1}"></div>
    <div><input type="number" class="price" min="0" value="${data.price||0}"></div>
    <button onclick="removeProduct(this)" class="delete">삭제</button>
  `;
  div.querySelectorAll("input").forEach(i=>i.addEventListener("input", calculateTotal));
  productsDiv.appendChild(div);
  calculateTotal();
}

function removeProduct(btn){ btn.parentElement.remove(); calculateTotal(); }
function deleteAllProducts(){ if(confirm("상품목록을 모두 삭제하시겠습니까?")){ productsDiv.innerHTML=""; calculateTotal(); } }

function getProductsArray(){ 
  const arr=[]; 
  document.querySelectorAll(".product").forEach(p=>arr.push({
    name:p.querySelector(".name").value,
    color:p.querySelector(".color").value,
    size:p.querySelector(".size").value,
    qty:Number(p.querySelector(".qty").value),
    price:Number(p.querySelector(".price").value)
  })); 
  return arr; 
}

function calculateTotal(){
  let sum=0;
  getProductsArray().forEach(p=>{ sum+=p.qty*p.price; });
  productSumEl.textContent = sum.toLocaleString();
  let shipping=sum===0?SHIPPING:SHIPPING; 
  shippingFeeEl.textContent = shipping.toLocaleString();
  totalAmountEl.textContent = (sum+shipping).toLocaleString();
  return sum+shipping;
}

function copyAccount(){ navigator.clipboard.writeText("카카오뱅크 3333-09797-1111 유혜정(유세연)"); alert("계좌번호가 복사되었습니다."); }

function validateOrder(){
  if(!document.getElementById("nickname").value || !document.getElementById("name").value || !document.getElementById("phone").value){ alert("고객 정보를 모두 입력해주세요."); return false; }
  const products=getProductsArray();
  if(products.length===0){ alert("상품을 하나 이상 추가해주세요."); return false; }
  for(let p of products){ if(!p.name||!p.qty||!p.price){ alert("상품명, 수량, 가격을 모두 입력해주세요."); return false; } }
  return true;
}

function checkOrder(){
  if(!validateOrder()) return;
  let html=`<p>닉네임: ${document.getElementById("nickname").value}</p>
  <p>이름: ${document.getElementById("name").value}</p>
  <p>연락처: ${document.getElementById("phone").value}</p>
  <p>주소: ${document.getElementById("address").value}</p>
  <h3>상품 목록</h3><ul>`;
  getProductsArray().forEach((p,i)=>{ html+=`<li>${i+1}. ${p.name} / ${p.color} / ${p.size} / ${p.qty}개 / ${p.price}원</li>`; });
  html+=`</ul><p>상품 합계: ${productSumEl.textContent}원</p>
  <p>배송비: ${shippingFeeEl.textContent}원</p>
  <p>총 결제금액: ${totalAmountEl.textContent}원</p>
  <p>입금계좌: 카카오뱅크 3333-09797-1111 유혜정(유세연)</p>`;
  document.getElementById("orderSummary").innerHTML=html;
  document.getElementById("orderModal").style.display="flex";
}

function closeModal(){ document.getElementById("orderModal").style.display="none"; }
function editOrder(){ closeModal(); }

function submitOrder(){
  if(!confirm("주문을 완료하시겠습니까?")) return;
  sendOrderData(); closeModal();
}

function submitOrderDirect(){
  if(!confirm("주문을 완료하시겠습니까?")) return;
  sendOrderData();
}

function sendOrderData(){
  const data={
    nickname: document.getElementById("nickname").value,
    name: document.getElementById("name").value,
    phone: document.getElementById("phone").value,
    address: document.getElementById("address").value,
    total: Number(totalAmountEl.textContent.replace(/,/g,'')),
    shipping: Number(shippingFeeEl.textContent.replace(/,/g,'')),
    products: getProductsArray()
  };
  fetch("https://script.google.com/macros/s/AKfycby46Q9iopmJHmsh37thoaJ1fJGlm3gWHjc2W0sVm84Ue9q0W31CyFR3KAd69qBqySXk/exec",{
    method:"POST",
    body: JSON.stringify(data)
  }).then(r=>r.json()).then(r=>{
    if(r.status==="success"){ alert("주문이 정상적으로 전송되었습니다!"); }
    else{ alert("주문 전송 실패: "+r.message); }
  }).catch(e=>alert("주문 전송 실패"));
}

function newOrder(){ if(confirm("새 주문을 시작하면 현재 입력한 내용은 모두 초기화됩니다.")){ location.reload(); } }

window.onload=()=>{ addProduct(); calculateTotal(); }
</script>

</body>
</html>
