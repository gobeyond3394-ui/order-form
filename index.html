<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‹¸U ì…€í”„ ì •ì‚° ì£¼ë¬¸ì„œ</title>

<style>
body {
  margin: 0;
  padding: 16px;
  font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  background: #fff;
  color: #111;
}

h1 {
  text-align: center;
  font-size: 20px;
  margin-bottom: 24px;
  color: #005FAE;
}

.section {
  margin-bottom: 28px;
}

.section-title {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 10px;
  color: #005FAE;
}

.divider {
  border-top: 1px solid #eee;
  margin: 12px 0 16px;
}

.field {
  margin-bottom: 12px;
}

label {
  display: block;
  font-size: 13px;
  margin-bottom: 4px;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-sizing: border-box;
}

input::placeholder {
  color: #999;
}

.address-row {
  display: flex;
  gap: 8px;
}

.address-row input {
  flex: 1;
}

.addr-btn {
  background:#005FAE;
  color:#fff;
  font-weight:700;
  border:none;
  border-radius:6px;
  padding:12px 14px;
  cursor:pointer;
  white-space: nowrap;
}

.product {
  border-top: 1px solid #eee;
  padding-top: 12px;
  margin-top: 12px;
}

.row {
  display: flex;
  gap: 8px;
}

.row .field {
  flex: 1;
}

button {
  padding: 12px 14px;
  font-size: 14px;
  font-weight: 700;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.button-line-3 {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 12px;
}

.button-line-3 button {
  flex: 0 0 calc((100% - 16px) / 3);
  max-width: calc((100% - 16px) / 3);
}

.btn-add { background:#005FAE; color:#fff; }
.btn-delete { background:#e74c3c; color:#fff; }
.btn-clear { background:#E0E0E0; color:#333; }

.btn-check { background:#E0E0E0; color:#333; }
.btn-submit { background:#005FAE; color:#fff; }
.btn-new { background:#e74c3c; color:#fff; }

.summary {
  border-top: 1px solid #eee;
  padding-top: 14px;
}

.summary-line {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin: 6px 0;
}

.summary-total {
  font-weight: 700;
  font-size: 16px;
  color: #005FAE;
}

.account-box {
  display: flex;
  align-items: center;
  background: #f4f7ff;
  border: 1px solid #d6e0ff;
  border-radius: 8px;
  padding: 10px;
  gap: 8px;
}

.account-text {
  font-size: 14px;
  white-space: nowrap;
  flex: 1;
}

.copy-btn {
  background: #005FAE;
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
}
</style>

<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>

<h1>ì‹¸U ì…€í”„ ì •ì‚° ì£¼ë¬¸ì„œ</h1>

<div class="section">
  <div class="section-title">ê³ ê° ì •ë³´</div>
  <div class="divider"></div>

  <div class="field">
    <label>ë‹‰ë„¤ì„</label>
    <input id="nickname" placeholder="ì˜ˆ) GOë¹„ìš˜ë“œ">
  </div>

  <div class="field">
    <label>ì´ë¦„</label>
    <input id="name" placeholder="ì˜ˆ) í™ê¸¸ë™">
  </div>

  <div class="field">
    <label>ì—°ë½ì²˜</label>
    <input id="phone" placeholder="ì˜ˆ) 010-1234-5678">
  </div>

  <div class="field">
    <label>ì£¼ì†Œ</label>
    <div class="address-row">
      <input id="address" placeholder="ì£¼ì†Œê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”" readonly>
      <button class="addr-btn" onclick="searchAddress()">ì£¼ì†Œê²€ìƒ‰</button>
    </div>
  </div>

  <div class="field">
    <label>ìƒì„¸ì£¼ì†Œ</label>
    <input id="addressDetail" placeholder="ì˜ˆ) 101ë™ 1203í˜¸">
  </div>
</div>

<div class="section">
  <div class="section-title">ìƒí’ˆ ì •ë³´</div>
  <div id="products"></div>

  <div class="button-line-3">
    <button class="btn-add" onclick="addProduct()">+ ìƒí’ˆ ì¶”ê°€</button>
    <button class="btn-delete" onclick="removeLastProduct()">â†‘ ìƒí’ˆ ì‚­ì œ</button>
    <button class="btn-clear" onclick="removeAllProducts()">- ìƒí’ˆëª©ë¡ ì‚­ì œ</button>
  </div>
</div>

<div class="section summary">
  <div class="summary-line"><span>ìƒí’ˆ í•©ê³„</span><span id="sum">0ì›</span></div>
  <div class="summary-line"><span>ë°°ì†¡ë¹„</span><span id="shipping">4,000ì›</span></div>
  <div class="summary-line summary-total"><span>ì´ ê²°ì œê¸ˆì•¡</span><span id="total">4,000ì›</span></div>
</div>

<div class="section">
  <div class="section-title">ì…ê¸ˆ ê³„ì¢Œ</div>
  <div class="account-box">
    <div class="account-text" id="accountText">
      ì¹´ì¹´ì˜¤ë±…í¬ 3333-09797-1111 ìœ í˜œì •(ìœ ì„¸ì—°)
    </div>
    <button class="copy-btn" onclick="copyAccount()">ë³µì‚¬</button>
  </div>
</div>

<div class="button-line-3">
  <button class="btn-check" onclick="checkOrder()">ì£¼ë¬¸ì„œ í™•ì¸</button>
  <button class="btn-submit" onclick="submitOrder()">ì£¼ë¬¸ ì™„ë£Œ</button>
  <button class="btn-new" onclick="newOrder()">ìƒˆ ì£¼ë¬¸</button>
</div>

<script>
const SHIPPING = 4000;
const productsDiv = document.getElementById("products");
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzBM-80dt-GELiI-vwNSi2bvRpuqBWW1NQGfu-cHpUobyO94Eh328Au_uA9j--jkZfDKw/exec";

function addProduct() {
  const div = document.createElement("div");
  div.className = "product";
  div.innerHTML = `
    <div class="field">
      <label>ìƒí’ˆëª…</label>
      <input placeholder="ì˜ˆ) ì•„ë¯¸ ë§¨íˆ¬ë§¨ / í´ë¡œ ê½ˆë°°ê¸° ë‹ˆíŠ¸ / ë©”ì¢… í›„ë“œí‹° / ê¼¼ë° ê¸´íŒ”í‹° / ì•Œë¡œ ì…‹ì—…">
    </div>
    <div class="row">
      <div class="field">
        <label>ìƒ‰ìƒ</label>
        <input placeholder="ì˜ˆ) ë¸”ë™ / ê²€ì •">
      </div>
      <div class="field">
        <label>ì‚¬ì´ì¦ˆ</label>
        <input placeholder="ì˜ˆ) L / ë¼ì§€ / 100">
      </div>
    </div>
    <div class="row">
      <div class="field">
        <label>ìˆ˜ëŸ‰</label>
        <input type="number" value="1" placeholder="1">
      </div>
      <div class="field">
        <label>ê°€ê²©</label>
        <input type="number" placeholder="ì˜ˆ) 59000">
      </div>
    </div>
  `;
  div.querySelectorAll("input").forEach(i => {
    i.addEventListener("input", calc);
    i.addEventListener("input", saveData);
  });
  productsDiv.appendChild(div);
  calc();
  saveData();
}

function removeLastProduct() {
  const items = document.querySelectorAll(".product");
  if (items.length === 0) return;
  items[items.length - 1].remove();
  calc();
  saveData();
}

function removeAllProducts() {
  if (!confirm("ìƒí’ˆëª©ë¡ì„ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) return;
  productsDiv.innerHTML = "";
  addProduct();
  saveData();
}

function calc() {
  let sum = 0;
  document.querySelectorAll(".product").forEach(p => {
    const qty = Number(p.querySelectorAll("input")[3].value || 0);
    const price = Number(p.querySelectorAll("input")[4].value || 0);
    sum += qty * price;
  });

  let shipping = sum >= 100000 ? 0 : SHIPPING;

  sumEl.innerText = sum.toLocaleString() + "ì›";
  shippingEl.innerText = shipping.toLocaleString() + "ì›";
  totalEl.innerText = (sum + shipping).toLocaleString() + "ì›";
}

const sumEl = document.getElementById("sum");
const shippingEl = document.getElementById("shipping");
const totalEl = document.getElementById("total");

function copyAccount() {
  const text = accountText.innerText;
  const accountNumberOnly = text.replace(/[^0-9]/g, "");
  navigator.clipboard.writeText(accountNumberOnly);
  alert("ê³„ì¢Œë²ˆí˜¸ë§Œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

function searchAddress() {
  new daum.Postcode({
    oncomplete: function(data) {
      address.value = data.address;
      addressDetail.focus();
      saveData();
    }
  }).open();
}

function checkOrder() {
  let text = "[ê³ ê° ì •ë³´]\n";
  text += `ë‹‰ë„¤ì„: ${document.getElementById("nickname").value}\n`;
  text += `ì´ë¦„: ${document.getElementById("name").value}\n`;
  text += `ì—°ë½ì²˜: ${document.getElementById("phone").value}\n`;
  text += `ì£¼ì†Œ: ${document.getElementById("address").value} ${document.getElementById("addressDetail").value}\n\n`;

  text += "[ìƒí’ˆ ì •ë³´]\n";
  document.querySelectorAll(".product").forEach((p, i) => {
    const inputs = p.querySelectorAll("input");
    text += `${i+1}. ${inputs[0].value} / ${inputs[1].value} / ${inputs[2].value} / ${inputs[3].value}ê°œ / ${inputs[4].value}ì›\n`;
  });

  text += `\nìƒí’ˆí•©ê³„: ${sumEl.innerText}\n`;
  text += `ë°°ì†¡ë¹„: ${shippingEl.innerText}\n`;
  text += `ì´ ê²°ì œê¸ˆì•¡: ${totalEl.innerText}\n\n`;
  text += "ìœ„ ë‚´ìš©ì´ ë§ìœ¼ë©´ ì£¼ë¬¸ ì™„ë£Œë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.";

  alert(text);
}

function submitOrder() {
  if (!confirm("ì£¼ë¬¸ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  saveData();

  const onlyNumber = (s) => Number(String(s || "").replace(/[^0-9]/g, "") || 0);

  const kstNowString = () => {
    const d = new Date(Date.now() + 9 * 60 * 60 * 1000);
    const yyyy = d.getUTCFullYear();
    const mm = String(d.getUTCMonth() + 1).padStart(2, "0");
    const dd = String(d.getUTCDate()).padStart(2, "0");
    const hh = String(d.getUTCHours()).padStart(2, "0");
    const mi = String(d.getUTCMinutes()).padStart(2, "0");
    const ss = String(d.getUTCSeconds()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd} ${hh}:${mi}:${ss}`;
  };

  const items = [];
  document.querySelectorAll(".product").forEach(p => {
    const i = p.querySelectorAll("input");
    items.push({
      productName: i[0].value || "",
      color: i[1].value || "",
      size: i[2].value || "",
      qty: Number(i[3].value || 0),
      price: Number(i[4].value || 0)
    });
  });

  const payload = {
    orderTime: kstNowString(),
    customer: {
      nickname: document.getElementById("nickname").value || "",
      name: document.getElementById("name").value || "",
      phone: document.getElementById("phone").value || "",
      address: `${document.getElementById("address").value || ""} ${document.getElementById("addressDetail").value || ""}`.trim()
    },
    items: items,
    sum: onlyNumber(sumEl.innerText),
    shipping: onlyNumber(shippingEl.innerText),
    total: onlyNumber(totalEl.innerText)
  };

  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  alert("ì£¼ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

/* ğŸ”¹ ìˆ˜ì •ëœ ë¶€ë¶„: ìƒí’ˆë§Œ ì´ˆê¸°í™” */
function newOrder() {
  if (!confirm("ìƒí’ˆë§Œ ìƒˆë¡œ ì£¼ë¬¸í• ê¹Œìš”?")) return;

  const data = JSON.parse(localStorage.getItem("orderData") || "{}");
  data.products = [];
  localStorage.setItem("orderData", JSON.stringify(data));

  productsDiv.innerHTML = "";
  addProduct();
  calc();
}

/* ğŸ”¹ ìë™ ì €ì¥ / ë³µì› (ì¶”ê°€ ì½”ë“œ) */
function saveData() {
  const data = {
    customer: {
      nickname: nickname.value,
      name: name.value,
      phone: phone.value,
      address: address.value,
      addressDetail: addressDetail.value
    },
    products: []
  };

  document.querySelectorAll(".product").forEach(p => {
    const i = p.querySelectorAll("input");
    data.products.push({
      name: i[0].value,
      color: i[1].value,
      size: i[2].value,
      qty: i[3].value,
      price: i[4].value
    });
  });

  localStorage.setItem("orderData", JSON.stringify(data));
}

function loadData() {
  const data = JSON.parse(localStorage.getItem("orderData") || "null");
  if (!data) return;

  nickname.value = data.customer.nickname || "";
  name.value = data.customer.name || "";
  phone.value = data.customer.phone || "";
  address.value = data.customer.address || "";
  addressDetail.value = data.customer.addressDetail || "";

  productsDiv.innerHTML = "";
  data.products.forEach(p => {
    addProduct();
    const last = productsDiv.lastElementChild.querySelectorAll("input");
    last[0].value = p.name;
    last[1].value = p.color;
    last[2].value = p.size;
    last[3].value = p.qty;
    last[4].value = p.price;
  });

  calc();
}

["nickname","name","phone","addressDetail"].forEach(id=>{
  document.getElementById(id).addEventListener("input", saveData);
});

loadData();
if (!document.querySelector(".product")) addProduct();
</script>

</body>
</html>
